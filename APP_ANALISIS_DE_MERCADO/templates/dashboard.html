{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<h1>Bienvenido, {{ user.username }}</h1>
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Proyectos</h5>
                <p class="card-text">{{ total_projects }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Tareas Totales</h5>
                <p class="card-text">{{ total_tasks }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Tus Tareas</h5>
                <p class="card-text">{{ user_tasks }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Ofertas de Empleo</h5>
                <p class="card-text">{{ total_job_offers }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <h3>Estado de Tareas</h3>
        <canvas id="taskStatusChart"></canvas>
    </div>
    <div class="col-md-6">
        <h3>Habilidades Más Demandadas</h3>
        <canvas id="topSkillsChart"></canvas>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-6">
        <h3>Distribución por Plataforma</h3>
        <canvas id="platformStatsChart"></canvas>
    </div>
    <div class="col-md-6">
        <h3>Predicciones de Habilidades</h3>
        <canvas id="predictionChart"></canvas>
    </div>
</div>

<h3 class="mt-4">Tareas Recomendadas</h3>
<ul class="list-group">
    {% for task in recommended_tasks %}
    <li class="list-group-item">{{ task.title }} (Proyecto: {{ task.project.name }})</li>
    {% empty %}
    <li class="list-group-item">No hay recomendaciones disponibles.</li>
    {% endfor %}
</ul>

<script>
    // Gráfico de estado de tareas
    const taskStatusData = {{ task_status_data|safe }};
    new Chart(document.getElementById('taskStatusChart'), {
        type: 'pie',
        data: {
            labels: taskStatusData.labels,
            datasets: [{
                data: taskStatusData.data,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0']
            }]
        }
    });

    // Gráfico de habilidades más demandadas
    const topSkillsData = {{ top_skills_data|safe }};
    new Chart(document.getElementById('topSkillsChart'), {
        type: 'bar',
        data: {
            labels: topSkillsData.labels,
            datasets: [{
                label: 'Habilidades Demandadas',
                data: topSkillsData.data,
                backgroundColor: '#36A2EB'
            }]
        }
    });

    // Gráfico de distribución por plataforma
    const platformStatsData = {{ platform_stats_data|safe }};
    new Chart(document.getElementById('platformStatsChart'), {
        type: 'doughnut',
        data: {
            labels: platformStatsData.labels,
            datasets: [{
                data: platformStatsData.data,
                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
            }]
        }
    });

    // Gráfico de predicciones
    const predictionData = {{ prediction_data|safe }};
    const datasets = Object.keys(predictionData).map(skill => ({
        label: skill,
        data: predictionData[skill].values,
        borderColor: '#' + Math.floor(Math.random()*16777215).toString(16),
        fill: false
    }));
    new Chart(document.getElementById('predictionChart'), {
        type: 'line',
        data: {
            labels: predictionData[Object.keys(predictionData)[0]]?.dates || [],
            datasets: datasets
        },
        options: {
            scales: {
                x: { title: { display: true, text: 'Fecha' } },
                y: { title: { display: true, text: 'Demanda' } }
            }
        }
    });
</script>
{% endblock %}